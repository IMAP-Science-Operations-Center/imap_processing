<?xml version='1.0' encoding='utf-8'?>
<xtce:SpaceSystem xmlns:xtce="http://www.omg.org/space/xtce" name="P_COD_HI_PHA">
	<xtce:Header date="2024-07" version="1.0" author="IMAP SDC" />
	<xtce:TelemetryMetaData>
		<xtce:ParameterTypeSet>
			<xtce:IntegerParameterType name="UINT1" signed="false">
				<xtce:IntegerDataEncoding sizeInBits="1" encoding="unsigned" />
			</xtce:IntegerParameterType>
			<xtce:IntegerParameterType name="UINT2" signed="false">
				<xtce:IntegerDataEncoding sizeInBits="2" encoding="unsigned" />
			</xtce:IntegerParameterType>
			<xtce:IntegerParameterType name="UINT3" signed="false">
				<xtce:IntegerDataEncoding sizeInBits="3" encoding="unsigned" />
			</xtce:IntegerParameterType>
			<xtce:IntegerParameterType name="UINT4" signed="false">
				<xtce:IntegerDataEncoding sizeInBits="4" encoding="unsigned" />
			</xtce:IntegerParameterType>
			<xtce:IntegerParameterType name="UINT11" signed="false">
				<xtce:IntegerDataEncoding sizeInBits="11" encoding="unsigned" />
			</xtce:IntegerParameterType>
			<xtce:IntegerParameterType name="UINT14" signed="false">
				<xtce:IntegerDataEncoding sizeInBits="14" encoding="unsigned" />
			</xtce:IntegerParameterType>
			<xtce:IntegerParameterType name="UINT16" signed="false">
				<xtce:IntegerDataEncoding sizeInBits="16" encoding="unsigned" />
			</xtce:IntegerParameterType>
			<xtce:IntegerParameterType name="UINT20" signed="false">
				<xtce:IntegerDataEncoding sizeInBits="20" encoding="unsigned" />
			</xtce:IntegerParameterType>
			<xtce:IntegerParameterType name="UINT32" signed="false">
				<xtce:IntegerDataEncoding sizeInBits="32" encoding="unsigned" />
			</xtce:IntegerParameterType>
			<xtce:BinaryParameterType name="HI_PHA_BITS">
				<xtce:UnitSet />
				<xtce:BinaryDataEncoding bitOrder="mostSignificantBitFirst">
					<xtce:SizeInBits>
						<xtce:FixedValue>5760</xtce:FixedValue>
					</xtce:SizeInBits>
				</xtce:BinaryDataEncoding>
			</xtce:BinaryParameterType>
		</xtce:ParameterTypeSet>
		<xtce:ParameterSet>
			<xtce:Parameter name="VERSION" parameterTypeRef="UINT3">
				<xtce:LongDescription>CCSDS Packet Version Number (always 0)</xtce:LongDescription>
			</xtce:Parameter>
			<xtce:Parameter name="TYPE" parameterTypeRef="UINT1">
				<xtce:LongDescription>CCSDS Packet Type Indicator (0=telemetry)</xtce:LongDescription>
			</xtce:Parameter>
			<xtce:Parameter name="SEC_HDR_FLG" parameterTypeRef="UINT1">
				<xtce:LongDescription>CCSDS Packet Secondary Header Flag (always 1)</xtce:LongDescription>
			</xtce:Parameter>
			<xtce:Parameter name="PKT_APID" parameterTypeRef="UINT11">
				<xtce:LongDescription>CCSDS Packet Application Process ID</xtce:LongDescription>
			</xtce:Parameter>
			<xtce:Parameter name="SEQ_FLGS" parameterTypeRef="UINT2">
				<xtce:LongDescription>CCSDS Packet Grouping Flags (3=not part of group)</xtce:LongDescription>
			</xtce:Parameter>
			<xtce:Parameter name="SRC_SEQ_CTR" parameterTypeRef="UINT14">
				<xtce:LongDescription>CCSDS Packet Sequence Count (increments with each new packet)</xtce:LongDescription>
			</xtce:Parameter>
			<xtce:Parameter name="PKT_LEN" parameterTypeRef="UINT16">
				<xtce:LongDescription>CCSDS Packet Length (number of bytes after Packet length minus 1)</xtce:LongDescription>
			</xtce:Parameter>
			<xtce:Parameter name="SHCOARSE" parameterTypeRef="UINT32" shortDescription="S/C TIME - SECONDS">
				<xtce:LongDescription>SECONDARY HEADER - WHOLE-SECONDS PART OF SCLK</xtce:LongDescription>
			</xtce:Parameter>
			<xtce:Parameter name="PACKET_VERSION" parameterTypeRef="UINT16" shortDescription="PACKET VERSION">
				<xtce:LongDescription>PACKET VERSION - THIS WILL BE INCREMENTED EACH TIME THE FORMAT OF THE PACKET CHANGESCOD_LO_PHA.</xtce:LongDescription>
			</xtce:Parameter>
			<xtce:Parameter name="SPIN_PERIOD" parameterTypeRef="UINT16" shortDescription="SPIN PERIOD REPORTED BY THE SPACECRAFT">
				<xtce:LongDescription>SPIN PERIOD REPORTED BY THE SPACECRAFT IN THE TIME AND STATUS MESSAGE.  REPORTED PERIOD IS THE PERIOD THAT WAS ACTIVE WHEN THE 16-SPIN ACQUISITION CYCLE STARTED.</xtce:LongDescription>
			</xtce:Parameter>
			<xtce:Parameter name="ACQ_START_SECONDS" parameterTypeRef="UINT32" shortDescription="ACQUISITION START TIME (SECONDS)">
				<xtce:LongDescription>FULL-SECONDS PORTION OF THE TIME AT WHICH THE 16-SPIN CYCLE STARTED</xtce:LongDescription>
			</xtce:Parameter>
			<xtce:Parameter name="ACQ_START_SUBSECONDS" parameterTypeRef="UINT20" shortDescription="ACQUISITION START TIME (SUBSECONDS)">
				<xtce:LongDescription>SUB-SECONDS PORTION OF THE TIME AT WHICH THE 16-SPIN CYCLE STARTED</xtce:LongDescription>
			</xtce:Parameter>
			<xtce:Parameter name="SPARE_1" parameterTypeRef="UINT2" shortDescription="SPARE FOR ALIGNMENT">
				<xtce:LongDescription>SPARE FOR ALIGNMENT</xtce:LongDescription>
			</xtce:Parameter>
			<xtce:Parameter name="ST_BIAS_GAIN_MODE" parameterTypeRef="UINT2" shortDescription="BIAS GAIN MODE (SUPRATHERMAL)">
				<xtce:LongDescription>BIAS GAIN MODE FOR THE SUPRATHERMAL SECTOR</xtce:LongDescription>
			</xtce:Parameter>
			<xtce:Parameter name="SW_BIAS_GAIN_MODE" parameterTypeRef="UINT2" shortDescription="BIAS GAIN MODE (SOLARWIND)">
				<xtce:LongDescription>BIAS GAIN MODE FOR THE SOLARWIND SECTOR</xtce:LongDescription>
			</xtce:Parameter>
			<xtce:Parameter name="PRIORITY" parameterTypeRef="UINT4" shortDescription="PRIORITY INCLUDED IN THIS PACKET" />
			<xtce:Parameter name="SUSPECT" parameterTypeRef="UINT1" shortDescription="INDICATES A DATA QUALITY ISSUE">
				<xtce:LongDescription>INDICATES THAT THERE WAS SOME ERROR DETECTED DURING ACQUISITION OR PROCESSING OF THE DATA.  ERRORS COULD INCLUDE CORRUPTED ACQUISITION MEMORY (I.E. EDAC ERRORS), TIMING VIOLATIONS, OR OTHER EVENTS THAT INTERRUPTED OR OTHERWISE AFFECTED DATA COLLECTION.</xtce:LongDescription>
			</xtce:Parameter>
			<xtce:Parameter name="COMPRESSED" parameterTypeRef="UINT1" shortDescription="WHETHER THE EVENT DATA IS COMPRESSED">
				<xtce:LongDescription>WHETHER THE EVENT DATA IS COMPRESSED.  IF 1/YES, EVENT_DATA ARRAY IS COMPRESSED USING THE RICE COMPRESSION ALGORITHM.</xtce:LongDescription>
			</xtce:Parameter>
			<xtce:Parameter name="NUM_EVENTS" parameterTypeRef="UINT32" shortDescription="NUMBER OF EVENTS INCLUDED IN THIS PACKET">
				<xtce:LongDescription>NUMBER OF EVENTS SELECTED FOR DOWNLINK (I.E. NUMBER OF EVENTS IN THE EVENT_DATA ARRAY)</xtce:LongDescription>
			</xtce:Parameter>
			<xtce:Parameter name="BYTE_COUNT" parameterTypeRef="UINT32" shortDescription="NUMBER OF BYTES IN THE EVENT DATA ARRAY">
				<xtce:LongDescription>NUMBER OF BYTES IN THE EVENT_DATA ARRAY.  IF COMPRESSED, THIS VALUE REPRESENTS THE LENGTH OF THE COMPRESSED DATA.</xtce:LongDescription>
			</xtce:Parameter>
			<xtce:Parameter name="EVENT_DATA" parameterTypeRef="HI_PHA_BITS" shortDescription="EVENT DATA">
				<xtce:LongDescription>OPTIONALLY COMPRESSED ARRAY OF EVENT DATA

FORMAT IS TBD; SOME CONSIDERATIONS/OPTIONS:
- FULL EVENTS HAVE A LOT OF REDUNDANT DATA (E.G. WILL HAVE MANY EVENTS WITH THE SAME PRIORITY/SPIN/SPIN PHASE INFORMATION).  HOW WELL DOES COMPRESSION TO DEAL WITH THE REDUNDANCY?
- COULD INCLUDE MINI-HEADERS FOR EACH (PRIORITY,SPIN, SPIN-PHASE) GROUP AND STRIP THE REDUNDANT DATA FROM THE EVENTS
- SHOULD EVENTS BE TIGHTLY PACKED, OR CAN WE PAD OUT TO 64-BIT WORD BOUNDARIES?  HOW WELL DOES COMPRESSION COMPENSATE FOR THE EXTRA BITS?

EACH EVENT CONSISTS OF:
- 10-BIT TOF
-  9-BIT SSD ENERGY
-  2-BIT ENERGY RANGE
-  7-BIT SPIN ANGLE
-  4-BIT SSD POSITION
-  4-BIT SPIN NUMBER
-  2-BIT PHA TYPE

TBD: EVENTS MAY BE TIGHTLY PACKED, OR MAY HAVE SPARES ADDED TO KEEP EACH EVENT BYTE-ALIGNED.  IN EITHER CASE, THERE MAY BE UP TO 1 BYTE OF PADDING TO KEEP THE TOTAL SIZE OF THE PACKET EVEN.</xtce:LongDescription>
			</xtce:Parameter>
			<xtce:Parameter name="CHKSUM" parameterTypeRef="UINT16">
				<xtce:LongDescription>PACKET CHECKSUM</xtce:LongDescription>
			</xtce:Parameter>
		</xtce:ParameterSet>
		<xtce:ContainerSet>
			<xtce:SequenceContainer name="CCSDSPacket">
				<xtce:EntryList>
					<xtce:ParameterRefEntry parameterRef="VERSION" />
					<xtce:ParameterRefEntry parameterRef="TYPE" />
					<xtce:ParameterRefEntry parameterRef="SEC_HDR_FLG" />
					<xtce:ParameterRefEntry parameterRef="PKT_APID" />
					<xtce:ParameterRefEntry parameterRef="SEQ_FLGS" />
					<xtce:ParameterRefEntry parameterRef="SRC_SEQ_CTR" />
					<xtce:ParameterRefEntry parameterRef="PKT_LEN" />
				</xtce:EntryList>
			</xtce:SequenceContainer>
			<xtce:SequenceContainer name="P_COD_HI_PHA">
				<xtce:BaseContainer containerRef="CCSDSPacket">
					<xtce:RestrictionCriteria>
						<xtce:Comparison parameterRef="PKT_APID" value="1169" useCalibratedValue="false" />
					</xtce:RestrictionCriteria>
				</xtce:BaseContainer>
				<xtce:EntryList>
					<xtce:ParameterRefEntry parameterRef="SHCOARSE" />
					<xtce:ParameterRefEntry parameterRef="PACKET_VERSION" />
					<xtce:ParameterRefEntry parameterRef="SPIN_PERIOD" />
					<xtce:ParameterRefEntry parameterRef="ACQ_START_SECONDS" />
					<xtce:ParameterRefEntry parameterRef="ACQ_START_SUBSECONDS" />
					<xtce:ParameterRefEntry parameterRef="SPARE_1" />
					<xtce:ParameterRefEntry parameterRef="ST_BIAS_GAIN_MODE" />
					<xtce:ParameterRefEntry parameterRef="SW_BIAS_GAIN_MODE" />
					<xtce:ParameterRefEntry parameterRef="PRIORITY" />
					<xtce:ParameterRefEntry parameterRef="SUSPECT" />
					<xtce:ParameterRefEntry parameterRef="COMPRESSED" />
					<xtce:ParameterRefEntry parameterRef="NUM_EVENTS" />
					<xtce:ParameterRefEntry parameterRef="BYTE_COUNT" />
					<xtce:ParameterRefEntry parameterRef="EVENT_DATA" />
					<xtce:ParameterRefEntry parameterRef="CHKSUM" />
				</xtce:EntryList>
			</xtce:SequenceContainer>
		</xtce:ContainerSet>
	</xtce:TelemetryMetaData>
</xtce:SpaceSystem>